# CMSIS Pack Generation 

The script `packgen.cmake` provides CMake macros to assist the generation of a CMSIS Pack according to the standard [format](https://www.keil.com/pack/doc/CMSIS/Pack/html/packFormat.html).

## Requirements

For validating and compressing the pack files, the `PackChk` and `7z` utilities shall be in the `PATH`:
- PackChk: https://github.com/ARM-software/CMSIS_5/tree/master/CMSIS/Utilities/
- 7z: https://www.7-zip.org/

## Quick Start
The example script [aws-iot-device-sdk-pack.cmake](https://github.com/brondani/aws-iot-device-sdk-embedded-C/blob/packgen/aws-iot-device-sdk-pack.cmake) uses of the present macros to declare some AWS IoT SDK components and their inter-dependencies.
<br />
The demonstration pack can be generated by cloning the following forked branch and executing the CMake script:
```
git clone -b packgen https://github.com/brondani/aws-iot-device-sdk-embedded-C.git
cd aws-iot-device-sdk-embedded-C/
git submodule update --init --recursive
cmake -P aws-iot-device-sdk-pack.cmake
```
The generated pack files will be stored in the `generated` folder.

## Build information
The macros expect every component has a `<component>FilePaths.cmake` file with variables containing build information.
Currently only source and include paths are handled by the macros.
<br />
The CMake variables shall follow the pattern:
- `<component>_SOURCES`
- `<component>_INCLUDE_PUBLIC_DIRS`

## Macros

### cmsis_set_pack_info
| Argument        | Description
|:----------------|:----------------------------------------
| name            | Unique name of the Software Pack
| description     | Description of the Software Pack
| vendor          | Name of the supplier or vendor of the Software Pack
| license         | Path to license document
| url             | HTTP URL or file URI location of the Software Pack
| version         | Version number of the Software Pack
| date            | Release date in the format YYYY-MM-DD
| changelog       | Release notes
| output          | Path to save generated pack files
<br />

### cmsis_add_component
| Argument        | Description
|:----------------|:----------------------------------------
| component       | Unique name of the component
| class           | Component class
| group           | Component group
| subgroup        | Component subgroup
| variant         | Component variant
| version         | Component version
| description     | Component brief description
| root            | Path to build info `<component>FilePaths.cmake`
<br />

### cmsis_add_config
| Argument        | Description
|:----------------|:----------------------------------------
| component       | Component name as used in `cmsis_add_component`
| file            | Path to configuration file
| category        | File category
| version         | File version
<br />

### cmsis_add_dependency
| Argument        | Description
|:----------------|:----------------------------------------
| component       | Component name as used in `cmsis_add_component`
| dependency      | Unique name of the dependency for internal use
| class           | Dependent component class
| group           | Dependent component group
| subgroup        | Dependent component subgroup
| variant         | Dependent component variant
| version         | Dependent component version
<br />

### cmsis_generate_pack
Create a PDSC file from template and copy files from their original locations into the output folder.
Validate the generated pack with the `PackChk` utility and finally compress the pack files with `7z`. 